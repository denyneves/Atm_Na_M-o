document.addEventListener("DOMContentLoaded",()=>{let e=(e,t,a="info",l=3e3)=>{let o=document.getElementById(e);o&&(o.textContent=t,o.className=`action-feedback ${a}`,o.style.display="block",setTimeout(()=>{o.style.display="none"},l))},t=(e,t)=>{e&&(t?(e.classList.add("loading"),e.disabled=!0):(e.classList.remove("loading"),e.disabled=!1))},a=e=>new Intl.NumberFormat("pt-AO",{style:"currency",currency:"AOA",minimumFractionDigits:0}).format(e),l=(e,t,l="withdrawal")=>{let o=document.getElementById("transaction-list"),s=o.querySelector(".sidebar__transaction-placeholder");s&&s.remove();let i=document.createElement("div");i.classList.add("sidebar__transaction");let r="withdrawal"===l?"ri-arrow-up-line":"ri-arrow-down-line",n="withdrawal"===l?"negative":"positive";i.innerHTML=`
            <div class="sidebar__transaction-icon ${l}">
                <i class="${r}"></i>
            </div>
            <div class="sidebar__transaction-details">
                <span class="sidebar__transaction-desc">${e}</span>
                <span class="sidebar__transaction-time">Agora</span>
            </div>
            <span class="sidebar__transaction-amount ${n}">${a(t)}</span>
        `,o.prepend(i)},o=document.getElementById("modal-mapa");if(o){let s=o.querySelector("#btn-find-me");o.querySelector("#map-feedback");let i=o.querySelectorAll(".simulated-pin:not(.pin-user)"),r=o.querySelector("#atm-details"),n=o.querySelector("#modal-rotas-trigger-placeholder"),c=o.querySelector("#modal-colaborativa-trigger-placeholder"),d=null;s?.addEventListener("click",()=>{t(s,!0),e("map-feedback","Simulando busca da sua localiza\xe7\xe3o...","info",1500),setTimeout(()=>{t(s,!1),e("map-feedback","Localiza\xe7\xe3o simulada encontrada!","success",2e3)},1500)}),i.forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.atmId,a=e.dataset.atmName,l=e.dataset.atmStatus,o=e.dataset.lastUpdate,s=e.dataset.confidence;d=t;let i="Indispon\xedvel",u="status--unknown";"available"===l?(i="Com Dinheiro",u="status--available"):"likely"===l?(i="Provavelmente Com Dinheiro",u="status--likely"):"unavailable"===l&&(i="Sem Dinheiro",u="status--unavailable"),r.innerHTML=`
                    <h4><i class="ri-bank-line"></i> ${a}</h4>
                    <p><strong>Status:</strong> <span class="status-badge ${u}">${i}</span></p>
                    <p><strong>\xdaltima Atualiza\xe7\xe3o:</strong> ${o}</p>
                    <p><strong>Confian\xe7a:</strong> ${s}% <span class="confidence-display">(Baseado em ${"available"===l||"unavailable"===l?"reportes recentes":"predi\xe7\xe3o e hist\xf3rico"})</span></p>
                    <div class="atm-details-actions">
                        <button class="button button--primary button--small button--flex" id="btn-route-to-atm">
                            <i class="ri-route-line"></i> Ver Rota
                        </button>
                        <button class="button button--secondary button--small button--flex button--ghost" id="btn-report-atm-status">
                            <i class="ri-feedback-line"></i> Reportar Status
                        </button>
                         <button class="button button--ghost button--small button--flex" data-modal-target="#modal-status">
                            <i class="ri-pulse-line"></i> Ver Detalhes do Status
                        </button>
                    </div>
                `,r.querySelector("#btn-route-to-atm")?.addEventListener("click",()=>{let e=document.getElementById("route-target-atm-name");e&&(e.textContent=a),n?.click()}),r.querySelector("#btn-report-atm-status")?.addEventListener("click",()=>{let e=document.getElementById("collab-atm-name");e&&(e.textContent=a),c?.click()})})})}let u=document.getElementById("modal-status");if(u){let m=u.querySelector("#btn-refresh-status"),$=u.querySelector("#status-time");u.querySelector("#status-feedback");let p=u.querySelector("#status-sources-container"),y=u.querySelector("#consolidated-badge"),f=u.querySelector("#status-interpretation"),b=u.querySelector("#overall-confidence-value"),v=u.querySelector("#overall-confidence-bar"),S=u.querySelector("#status-history-list"),q=e=>{p.querySelectorAll(".status-source").forEach(t=>{let a=t.dataset.source,l=t.querySelector(".status-source-detail"),o=t.querySelector(".confidence-fill"),s=t.querySelector(".confidence-value");e.sources[a]&&(l.textContent=e.sources[a].detail,o.style.width=`${e.sources[a].confidence}%`,s.textContent=`${e.sources[a].confidence}%`,o.className="confidence-fill",e.sources[a].confidence<40?o.classList.add("low"):e.sources[a].confidence<75?o.classList.add("medium"):o.classList.add("high"))}),y.textContent=e.consolidated.statusText,y.className=`status-badge ${e.consolidated.statusClass}`,f.textContent=e.consolidated.interpretation,b.textContent=`${e.consolidated.overallConfidence}%`,v.style.width=`${e.consolidated.overallConfidence}%`,v.className="confidence-fill",e.consolidated.overallConfidence<40?v.classList.add("low"):e.consolidated.overallConfidence<75?v.classList.add("medium"):v.classList.add("high");let t=S.querySelector(".placeholder");t&&t.remove();let a=document.createElement("li");a.innerHTML=`
                 <span class="history-status ${e.consolidated.statusClass}">${e.consolidated.statusText}</span>
                 <span class="history-time">${new Date().toLocaleTimeString("pt-BR")}</span>
             `,S.prepend(a),$.textContent=new Date().toLocaleTimeString("pt-BR")};m?.addEventListener("click",()=>{t(m,!0),e("status-feedback","Simulando atualiza\xe7\xe3o de status...","info",1500),setTimeout(()=>{let a=Math.random(),l;q(l=a<.5?{sources:{community:{detail:'5 reportes "Com Dinheiro"',confidence:90},prediction:{detail:"preven\xe7\xe3o de alta probabilidade",confidence:85},verification:{detail:"Verificado h\xe1 1h",confidence:95}},consolidated:{statusText:"Com Dinheiro",statusClass:"status--available",interpretation:"Alta confian\xe7a de disponibilidade baseado em reportes e IA.",overallConfidence:92}}:a<.8?{sources:{community:{detail:'1 reporte "Com Dinheiro"',confidence:60},prediction:{detail:"preven\xe7\xe3o de m\xe9dia probabilidade",confidence:75},verification:{detail:"Verificado h\xe1 6h",confidence:50}},consolidated:{statusText:"Prov\xe1vel",statusClass:"status--likely",interpretation:"M\xe9dia confian\xe7a. Reporte antigo, mas indica chance.",overallConfidence:68}}:{sources:{community:{detail:'3 reportes "Sem Dinheiro"',confidence:88},prediction:{detail:"prev\xea baixa probabilidade",confidence:70},verification:{detail:"Verificado h\xe1 3h",confidence:80}},consolidated:{statusText:"Sem Dinheiro",statusClass:"status--unavailable",interpretation:"Alta confian\xe7a de indisponibilidade baseado em reportes.",overallConfidence:85}}),t(m,!1),e("status-feedback","Status atualizado com sucesso!","success",2e3)},1500)})}let h=document.getElementById("modal-rotas");if(h){let g=h.querySelector("#route-options-selector"),k=h.querySelector("#route-distance"),L=h.querySelector("#route-time"),_=h.querySelector("#route-cost"),C=h.querySelector("#route-safety"),x=h.querySelector(".safety-indicator"),E=h.querySelector("#route-traffic"),w=h.querySelector("#route-preview-img"),A=h.querySelector("#route-summary-details h4"),D=h.querySelector("#btn-alt-route"),T=h.querySelectorAll("#share-buttons button"),B=h.querySelector("#btn-start-navigation");g?.addEventListener("click",t=>{let l=t.target.closest(".selectable-card");if(!l||l.classList.contains("selected"))return;g.querySelector(".selected")?.classList.remove("selected"),l.classList.add("selected");let o=l.dataset;k.textContent=o.distance,L.textContent=o.time,_.textContent="0"===o.cost?"Gr\xe1tis":a(parseInt(o.cost))||o.cost,C.textContent=o.safety,E.textContent=o.traffic,w.src=o.img||"img/route-placeholder.png",w.alt=`Pr\xe9via da rota ${o.routeType}`,A.innerHTML=`<i class="ri-information-line"></i> Detalhes da Rota (${l.querySelector("span").textContent}):`,x.className="safety-indicator","Alta"===o.safety?x.classList.add("safe"):"M\xe9dia"===o.safety?x.classList.add("medium"):"Baixa"===o.safety&&x.classList.add("low"),e("route-preview-feedback",`Rota ${o.routeType} selecionada.`,"info",1500)}),D?.addEventListener("click",()=>{t(D,!0),e("alt-route-feedback","Simulando busca por rota alternativa...","info",1500),setTimeout(()=>{t(D,!1),e("alt-route-feedback","Rota alternativa encontrada (simulado)!","success",2e3)},1500)}),T.forEach(a=>{a.addEventListener("click",()=>{let l=a.dataset.share;t(a,!0),e("share-feedback",`Simulando compartilhamento via ${l}...`,"info",1e3),setTimeout(()=>{t(a,!1),"copy"===l?e("share-feedback","Link da rota copiado para \xe1rea de transfer\xeancia (Simulado)!","success",2500):e("share-feedback",`Compartilhamento via ${l} iniciado (Simulado)!`,"success",2500)},1e3)})}),B?.addEventListener("click",()=>{t(B,!0),e("share-feedback","Abrindo aplicativo de navega\xe7\xe3o (Simulado)...","info",2e3),setTimeout(()=>{t(B,!1),e("share-feedback","Navega\xe7\xe3o iniciada em app externo (Simulado)!","success",2500)},2e3)})}let I=document.getElementById("modal-filtros");if(I){let N=I.querySelector("#filters-content"),R=I.querySelector("#filter-radius"),P=I.querySelector("#radius-value"),M=I.querySelector("#filter-count"),z=I.querySelector("#btn-clear-filters"),F=I.querySelector("#btn-apply-filters"),O=I.querySelector("#btn-save-filters"),H=N.querySelectorAll('input[type="checkbox"]'),V=U(),j=()=>{let e=(parseInt(R.value)/1e3).toFixed(1);P.textContent=`${e} km`},G=()=>{let t=Array.from(H).filter(e=>e.checked&&"filter-service-levantamentos"!==e.id).length,a=Math.max(5,150-10*t-parseInt(R.value)/100);M.textContent=Math.round(a),e("filter-apply-feedback","Contagem de ATMs atualizada (simulado).","info",1500)};function U(){let e={};return H.forEach(t=>e[t.value]=t.checked),e.radius=R.value,JSON.stringify(e)}let J=()=>{let e=U(),t=e!==V;z.disabled=!t,F.disabled=!t};R?.addEventListener("input",()=>{j(),G(),J()}),N?.addEventListener("change",e=>{e.target.matches('input[type="checkbox"]')&&(G(),"all"===e.target.value&&e.target.checked?I.querySelectorAll('.bank-filters input[type="checkbox"]').forEach(e=>{"all"!==e.value&&(e.checked=!1)}):"bank"===e.target.name&&"all"!==e.target.value&&(I.querySelector('input[value="all"]').checked=!1),J())}),z?.addEventListener("click",()=>{H.forEach(e=>e.checked="filter-service-levantamentos"===e.id),R.value=1500,j(),G(),e("filter-apply-feedback","Filtros limpos.","success",2e3),V=U(),J()}),F?.addEventListener("click",()=>{t(F,!0),e("filter-apply-feedback","Aplicando filtros no mapa (Simulado)...","info",1500),setTimeout(()=>{t(F,!1),e("filter-apply-feedback","Filtros aplicados! Veja o mapa.","success",2500),V=U(),J()},1500)}),O?.addEventListener("click",()=>{t(O,!0),e("filter-apply-feedback","Salvando combina\xe7\xe3o de filtros (Simulado)...","info",1500),setTimeout(()=>{t(O,!1),e("filter-apply-feedback","Filtros salvos como prefer\xeancia!","success",2500)},1500)}),j(),G(),J()}let K=document.getElementById("modal-economia");if(K){let Q=K.querySelector("#withdrawal-amount"),W=K.querySelector("#informal-fee-percent"),X=K.querySelector("#informal-fee-value"),Y=K.querySelector("#informal-total-cost"),Z=K.querySelector("#informal-fee-amount"),ee=K.querySelector("#official-total-cost"),et=K.querySelector("#instant-savings"),ea=K.querySelector("#monthly-savings"),el=K.querySelector("#monthly-savings-progress"),eo=K.querySelector(".security-link"),es=()=>{let e=parseFloat(Q.value)||0,t=parseInt(W.value)||0,l=e*(t/100),o=e+l,s=l;X.textContent=`${t}%`,ee.textContent=a(e),Y.textContent=a(o),Z.textContent=a(l),et.textContent=a(s);let i=42500+s;ea.textContent=a(i);let r=Math.min(100,i/1e5*100);el.style.width=`${r}%`};Q?.addEventListener("input",es),W?.addEventListener("input",es),eo?.addEventListener("click",()=>{let e=eo.dataset.modalTarget,t=document.querySelector(e);K.querySelector(".modal__close"),t&&("function"==typeof openModal?openModal(t):(t.classList.add("modal--open"),t.setAttribute("aria-hidden","false"),document.body.classList.add("modal-open-body"),t.querySelector(".modal__container").focus()))}),es()}let ei=document.getElementById("modal-colaborativa");if(ei){let er=ei.querySelectorAll(".report-button"),en=ei.querySelector("#other-issue-section"),ec=ei.querySelector("#issue-description"),ed=ei.querySelector("#btn-submit-issue");ei.querySelector("#report-feedback-collab");let eu=ei.querySelector("#collab-score"),em=ei.querySelector("#collab-reports"),e$=ei.querySelector("#collab-badge-icon"),ep=ei.querySelector("#collab-badge-name"),ey=ei.querySelector("#badge-progress-bar"),ef=ei.querySelector("#user-activity-list"),eb=125,ev=15,eS=(e,t)=>{eb+=e,ev+=1,eu.textContent=eb,em&&(em.textContent=ev);let a="Bronze",l="Prata",o=eb/250*100,s="ri-copper-coin-line";eb>=250&&eb<500?(a="Prata",l="Ouro (500 Pts)",s="ri-copper-diamond-line",o=(eb-250)/250*100):eb>=500&&(a="Ouro",l="Platina (1000 Pts)",s="ri-trophy-line",o=(eb-500)/500*100),ep.textContent=a,e$.innerHTML=`<i class="${s}"></i>`,ey.style.width=`${Math.min(100,o)}%`,ei.querySelector(".next-badge-progress small").textContent=`Pr\xf3ximo N\xedvel: ${l}`;let i=document.createElement("li"),r="ri-question-line",n="";t.includes("Com Dinheiro")?(r="ri-thumb-up-line",n="success-color"):t.includes("Sem Dinheiro")?(r="ri-thumb-down-line",n="error-color"):t.includes("Problema")&&(r="ri-alert-line",n="warning-color"),i.innerHTML=`<i class="${r} ${n}"></i> Reportou "${t}" (+${e} pts)`,ef.prepend(i)};er.forEach(a=>{a.addEventListener("click",()=>{let o=a.dataset.status,s=parseInt(a.dataset.points),i=a.textContent.trim().split("(")[0].trim();t(a,!0),e("report-feedback-collab","Enviando seu reporte...","info",1500),setTimeout(()=>{t(a,!1),"issue"===o?(en.style.display="block",ec.focus(),e("report-feedback-collab",'Reporte "Outro Problema" recebido. Descreva abaixo se desejar.',"success",3e3),eS(s,i)):(en.style.display="none",ec.value="",e("report-feedback-collab",`Reporte "${i}" enviado com sucesso! Obrigado por colaborar. (+${s} pts)`,"success",3e3),eS(s,i),l(`Reporte: ${i}`,s,"report"))},1500)})}),ed?.addEventListener("click",()=>{t(ed,!0),e("report-feedback-collab","Enviando descri\xe7\xe3o do problema...","info",1e3),setTimeout(()=>{t(ed,!1),e("report-feedback-collab","Descri\xe7\xe3o enviada. Agradecemos o detalhe!","success",2500),en.style.display="none",ec.value=""},1e3)})}let eq=document.getElementById("modal-saque-simulado");if(eq){let eh=eq.querySelector("#sim-withdrawal-amount"),eg=eq.querySelector("#btn-start-sim"),ek=eq.querySelector("#btn-reset-sim"),eL=eq.querySelector("#formal-steps"),e_=eq.querySelector("#informal-steps"),eC=eq.querySelectorAll(".sim-amount"),ex=eq.querySelectorAll(".sim-fee"),e3=eq.querySelector("#informal-total-cost-sim"),eE=eq.querySelector("#formal-time"),e9=eq.querySelector("#informal-time"),ew=eq.querySelector(".simulation-conclusion"),eA=eq.querySelector(".simulation-setup"),e0=!1,e8=()=>{e0=!1,eg.disabled=!1,eA.style.display="flex",ew.style.display="none",[eL,e_].forEach(e=>{e.querySelectorAll(".step-item").forEach(e=>{e.className="step-item pending",e.querySelector(".step-status i").className="ri-time-line"})}),e("sim-start-feedback","Simula\xe7\xe3o reiniciada. Defina o valor e comece.","info",3e3)},eD=(e,t,a)=>new Promise(l=>{setTimeout(()=>{let a=e.querySelectorAll(".step-item");t>0&&(a[t-1].classList.remove("active"),a[t-1].classList.add("completed"),a[t-1].querySelector(".step-status i").className="ri-check-line","informal-steps"===e.id&&a[t-1].classList.add("informal-completed")),t<a.length&&(a[t].classList.remove("pending"),a[t].classList.add("active"),a[t].querySelector(".step-status i").className="ri-loader-4-line animate-spin"),l()},a)});eg?.addEventListener("click",async()=>{if(e0)return;e0=!0,eg.disabled=!0,eA.style.display="none",ew.style.display="none";let t=parseInt(eh.value),o=.15*t,s=t+o;eC.forEach(e=>e.textContent=a(t)),ex.forEach(e=>e.textContent=a(o)),e3.textContent=a(s);let i=[1e3,2500,1500,500,500],r=[3e3,1e3,500,4e3,500],n=i.reduce((e,t)=>e+t,0),c=r.reduce((e,t)=>e+t,0);eE.textContent=`~ ${Math.round(n/1e3/60)} min`,e9.textContent=`~ ${Math.round(c/1e3/60)} min`,e("sim-start-feedback","Iniciando simula\xe7\xe3o comparativa...","info",2e3);let d=(async()=>{for(let e=0;e<eL.querySelectorAll(".step-item").length;e++)await eD(eL,e,i[e]);let t=eL.querySelector(".step-item:last-child");t?.classList.remove("active"),t?.classList.add("completed"),t.querySelector(".step-status i").className="ri-check-line"})(),u=(async()=>{for(let e=0;e<e_.querySelectorAll(".step-item").length;e++)await eD(e_,e,r[e]);let t=e_.querySelector(".step-item:last-child");t?.classList.remove("active"),t?.classList.add("completed","informal-completed"),t.querySelector(".step-status i").className="ri-check-line"})();await Promise.all([d,u]),ew.style.display="block",e("sim-start-feedback","Simula\xe7\xe3o conclu\xedda!","success",3e3),e0=!1,l("Saque Formal Simulado",-t,"withdrawal")}),ek?.addEventListener("click",e8),ew.style.display="none"}document.body.addEventListener("click",e=>{let t=e.target.closest("[data-modal-target]");if(t&&t.closest(".modal")){e.preventDefault();let a=t.closest(".modal"),l=t.dataset.modalTarget,o=document.querySelector(l);o&&"function"==typeof openModal&&"function"==typeof closeModal?(closeModal(a),setTimeout(()=>{openModal(o)},200)):o&&(a.classList.remove("modal--open"),a.setAttribute("aria-hidden","true"),document.body.classList.remove("modal-open-body"),o.classList.add("modal--open"),o.setAttribute("aria-hidden","false"),document.body.classList.add("modal-open-body"),o.querySelector(".modal__container").focus())}})});